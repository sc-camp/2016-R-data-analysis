{
    "contents" : "library(ggplot2)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(broom)\nlibrary(car)\nlibrary(data.table)\n\ndata_comp = data.table(read.csv(\"data/compensationo.csv\"))\nprint(summary(data_comp))\n\nggplot(data=data_comp, aes(x=ROOT, y=FRUIT, color=GRAZING)) + theme_bw() + geom_point() \nggplot(data=data_comp, aes(x=ROOT, y=FRUIT, color=GRAZING)) + theme_bw() + geom_boxplot() \n\nggplot(data=data_comp, aes(x=ROOT, y=FRUIT, color=GRAZING)) + theme_bw() + geom_point() + geom_smooth(method=\"lm\", fullrange = TRUE, se = FALSE) + expand_limits(x = 0, y = 0)\n\nlm_plus = lm(FRUIT~ROOT+GRAZING, data=data_comp)\nsummary(lm_plus)\nvif(lm_plus)\npar(mfrow=c(2,2))\nplot(lm_plus)\npar(mfrow=c(1,1))\n\nlm_interaction = lm(FRUIT~ROOT:GRAZING, data=data_comp)\nsummary(lm_interaction)\n# vif(lm_interaction)\npar(mfrow=c(2,2))\nplot(lm_interaction)\npar(mfrow=c(1,1))\n\nlm_all = lm(FRUIT~ROOT*GRAZING, data=data_comp)\nlm_all = lm(FRUIT~ROOT+GRAZING+ROOT:GRAZING, data=data_comp)\n\n\nsummary(lm_all)\nvif(lm_all)\npar(mfrow=c(2,2))\nplot(lm_all)\npar(mfrow=c(1,1))\n\n## vif shows that lm_all has more than 10 for GRAZING and  ROOT:GRAZING \n# we redo the model without GRAZING\nlm_simple = lm(FRUIT~ROOT, data=data_comp)\nsummary(lm_simple)\n# vif(lm_simple)\npar(mfrow=c(2,2))\nplot(lm_simple)\npar(mfrow=c(1,1))\n\nanova(lm_plus, update(lm_plus, ~. - GRAZING))\nanova(lm_plus, lm_simple)\n\nlogLik(lm_simple)\nlogLik(lm_plus) ## best logLik\nlogLik(lm_interaction)\nlogLik(lm_all) ## best logLik\n\nAIC(lm_simple)\nAIC(lm_plus) ## best AIC\nAIC(lm_interaction)\nAIC(lm_all)\n\ncoef(summary(lm_plus))\n\n\n# > summary(lm_all)\n# \n# Call:\n#   lm(formula = FRUIT ~ ROOT * GRAZING, data = data_comp)\n# \n# Residuals:\n#   Min       1Q   Median       3Q      Max \n# -17.3177  -2.8320   0.1247   3.8511  17.1313 \n# \n# Coefficients:\n#   Estimate Std. Error t value Pr(>|t|)    \n# (Intercept)          -125.173     12.811  -9.771 1.15e-11 ***\n#   ROOT                   23.240      1.531  15.182  < 2e-16 ***\n#   GRAZINGUngrazed        30.806     16.842   1.829   0.0757 .  \n# ROOT:GRAZINGUngrazed    0.756      2.354   0.321   0.7500    \n# ---\n#   Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1\n# \n# Residual standard error: 6.831 on 36 degrees of freedom\n# Multiple R-squared:  0.9293,\tAdjusted R-squared:  0.9234 \n# F-statistic: 157.6 on 3 and 36 DF,  p-value: < 2.2e-16\n# \n# > summary(lm_plus)\n# \n# Call:\n#   lm(formula = FRUIT ~ ROOT + GRAZING, data = data_comp)\n# \n# Residuals:\n#   Min       1Q   Median       3Q      Max \n# -17.1920  -2.8224   0.3223   3.9144  17.3290 \n# \n# Coefficients:\n#   Estimate Std. Error t value Pr(>|t|)    \n# (Intercept)     -127.829      9.664  -13.23 1.35e-15 ***\n#   ROOT              23.560      1.149   20.51  < 2e-16 ***\n#   GRAZINGUngrazed   36.103      3.357   10.75 6.11e-13 ***\n#   ---\n#   Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1\n# \n# Residual standard error: 6.747 on 37 degrees of freedom\n# Multiple R-squared:  0.9291,\tAdjusted R-squared:  0.9252 \n# F-statistic: 242.3 on 2 and 37 DF,  p-value: < 2.2e-16\n\n\n\n### slope deviation is 0.756 with 2.35 std so they are the same....\n## thus we get rid of interaction and keep lm_simple\n## slope is 23.56, intercept difference for ungrazed is +36.103\n\n\ndata_to_predict = copy(data_comp)\ndata_to_predict[,FRUIT:=NULL]\nd1 = data.frame(predicted=predict(lm_plus, data_to_predict))\nd2 = data.frame(observed=data_comp$FRUIT)\n\nd1$sample = as.numeric(rownames(d1))\nd2$sample = as.numeric(rownames(d2))\n\ndd = merge(d1, d2)\ndd_g = gather(dd, type, value, predicted:observed)\n\nggplot(data=dd_g, aes(x=sample, y=value, color=type)) + theme_bw() + geom_bar(stat=\"identity\", position=\"dodge\")\n\nt.test(d1$predict, d2$observed, paired = TRUE)\n\n",
    "created" : 1449048854491.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "628817938",
    "id" : "2F59E360",
    "lastKnownWriteTime" : 1449055785,
    "path" : "~/Documents/formations/R - Ecosse/exercises/module5/ancova.R",
    "project_path" : "ancova.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "type" : "r_source"
}