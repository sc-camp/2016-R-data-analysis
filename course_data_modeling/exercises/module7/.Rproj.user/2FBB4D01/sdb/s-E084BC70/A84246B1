{
    "contents" : "library(ggplot2)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(broom)\nlibrary(car)\nlibrary(boot)\nlibrary(data.table)\nlibrary(gridExtra)\nlibrary(GGally)\n\ntannin = data.table(read.csv(\"data/tannin.csv\"))\nprint(summary(tannin))\nprint(str(tannin))\nggpairs(tannin)\n\nhist(tannin$GROWTH)\nhist(tannin$TANNIN)\n\ntanfit <- lm(GROWTH ~ TANNIN, data = tannin)\nsummary(tanfit)\n## Get a 'tidy' version of the model coefficients\ntidy(tanfit)\nglance(tanfit)\n\ntanfit %>%\n  augment() %>%\n  ggplot(data = .,\n         aes(x = TANNIN,\n             y = GROWTH)) +\n  geom_point() +                  # points from original data frame\n  geom_line(aes(y = .fitted)) +   # line from model fit\n  geom_ribbon(aes(ymin = .fitted - (2 * .se.fit),\n                  ymax = .fitted + (2 * .se.fit)),   # CIs from model fit\n              alpha = 0.3) +\n  theme_bw()\n\n## OR\nvisreg(tanfit)\n\n\n### ex 2\ncomp = data.table(read.csv(\"data/compensationo.csv\"))\nprint(summary(comp))\nprint(str(comp))\nggpairs(comp)\n\nhist(comp$ROOT)\nhist(comp$FRUIT)\n# hist(comp$GRAZING)\n\n## there was no interesting interaction in the model, we rebuild it.\ncomp_mod = lm(FRUIT~ROOT+GRAZING, data=comp)\ntidy(comp_mod)\n\n### std ggplot\ncomp_mod %>%\n  augment() %>%\n  ggplot(data = .,\n         aes(x = ROOT,\n             y = FRUIT,\n             colour = GRAZING,\n             fill = GRAZING)) +\n  geom_point() +                  # points from original data frame\n  geom_line(aes(y = .fitted)) +   # line from model fit\n  geom_ribbon(aes(ymin = .fitted - (1.96 * .se.fit),\n                  ymax = .fitted + (1.96 * .se.fit)),   # CIs from model fit\n              alpha = 0.3,\n              linetype = 0) +\n  theme_bw()\n\n## OR:\nvisreg(comp_mod) # by default plot is fixed with the median but can be changed with cond=\nmedian(comp$ROOT)\nvisreg(comp_mod, xvar = \"GRAZING\", cond=list(ROOT=10))\n\nvisreg(comp_mod, xvar = \"ROOT\", by=\"GRAZING\") \n\n### Ex 3:\nisle = data.table(read.csv(\"data/isolation.csv\"))\nprint(summary(isle))\nprint(str(isle))\nggpairs(isle)\n\nhist(isle$ISOLATION)\nhist(isle$INCIDENCE) ## yes or no. it is a binomial distribution\nhist(isle$AREA)\n\n\nanova(glm(INCIDENCE~AREA*ISOLATION,data=isle,binomial), glm(INCIDENCE~AREA+ISOLATION,data=isle,binomial), test=\"Chi\")\n## interaction is not present\n\nmod_isol<-glm(INCIDENCE~AREA+ISOLATION,data=isle,binomial)\ntidy(mod_isol)\naugment(mod_isol)\n\nvisreg(mod_isol)\n\nvisreg(mod_isol, xvar = \"ISOLATION\") ## displays in logit scale\nvisreg(mod_isol, xvar = \"AREA\")\n\nvisreg(mod_isol, xvar = \"ISOLATION\", scale = \"response\", rug=FALSE, ylab=\"Incidence\",xlab=\"Isolation\")\nvisreg(mod_isol, xvar = \"AREA\", scale = \"response\", rug=FALSE)\n\n### FLY sex\nDF <- read.csv(\"data/FLYSEX.csv\")\nstr(DF)\n# quality control\nhist(DF$LEG)\nhist(DF$ABDOMEN)\nhist(DF$ATTR)\n# def poisson\n\n# simple bivar plots\nplot(ATTR~LEG,data=DF)\nplot(ATTR~ABDOMEN,data=DF)\n\n# prelim look at combined effects\nggplot(DF, aes(x = LEG,\n               y = ABDOMEN,\n               colour = ATTR)) +\n  geom_jitter(alpha = 0.8,\n              size = 3)\n\n\nhead(DF)\nORN.MOD<-glm(ATTR~LEG*ABDOMEN,data=DF,family=poisson)\nsummary(ORN.MOD)\n# underdispersion\n\nORN.MOD2<-glm(ATTR~LEG*ABDOMEN,data=DF,family=quasipoisson)\nsummary(ORN.MOD2)\n\nlibrary(boot)\nglm.diag.plots(ORN.MOD)\nglm.diag.plots(ORN.MOD2)\n\n\nanova(ORN.MOD, ORN.MOD2, test=\"Chi\")\n## same in fact.\n\n## simplify model?\nORN.MOD21<-update(ORN.MOD2, ~. -LEG:ABDOMEN)\nanova(ORN.MOD2,ORN.MOD21,test=\"Chi\")\n## interaction is important we must keep it\n\nvisreg(ORN.MOD2, xvar=\"LEG\", by=\"ABDOMEN\", scale=\"response\", overlay=TRUE)\nvisreg(ORN.MOD2, xvar=\"ABDOMEN\", by=\"LEG\", scale=\"response\", overlay=TRUE)\n\nvisreg(ORN.MOD2, xvar=\"LEG\", by=\"ABDOMEN\", overlay=TRUE)\nvisreg(ORN.MOD2, xvar=\"ABDOMEN\", by=\"LEG\", overlay=TRUE)\n\n\n\n\n\n",
    "created" : 1449133292603.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3371152189",
    "id" : "A84246B1",
    "lastKnownWriteTime" : 1449143761,
    "path" : "~/Documents/formations/R - Ecosse/exercises/module7/mod7.R",
    "project_path" : "mod7.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "type" : "r_source"
}